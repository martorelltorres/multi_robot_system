<launch>
 <!-- Params -->
  <arg name="place" default="bendinat.yaml"/>
  <arg name="enableIquaASV" default="false"/>
  <arg name="enableIquaAUV" default="false"/>
  <arg name="enableRviz" default="true"/>
  <arg name="enableCollisonAvoidance" default="false"/>
  <arg name="enableCommunicationModule" default="false"/>

  <!-- general robot information -->
  <arg name="robot_1" default="turbot1"/>
  <arg name="robot_2" default="turbot2"/>
  <arg name="robot_3" default="xiroi"/>
  <arg name="navigation_topic_robot_1" default="/$(arg robot_1)/navigator/navigation"/>
  <arg name="navigation_topic_robot_2" default="/$(arg robot_2)/navigator/navigation"/>
  <arg name="navigation_topic_robot_3" default="/$(arg robot_3)/navigator/navigation"/>


  <!-- Launch the Turbot Simulation -->
  <include  file="$(find multi_robot_system)/launch/turbot_simulation.launch">
    <arg name="place" value="$(arg place)"/>
  </include>

  <!-- Launch the Xiroi Simulation -->
  <include  file="$(find cola2_xiroi)/launch/simulation.launch">
    <arg name="enableIqua" value="$(arg enableIquaASV)"/>
    <arg name="place" value="$(arg place)"/>
  </include>
  
   <!-- load the multi_robot_system.yaml parameters file -->
  <rosparam command="load" file="$(find multi_robot_system)/config/multi_robot_system.yaml"/>

  <!-- Robot 1: turbot1 AUV -->
  <node name="multi_robot_system_$(arg robot_1)" pkg="multi_robot_system" type="multirobot_system.py" output="screen" respawn="true">
    <param name="robot_ID" value="0"/>
    <param name="robot_name" value="$(arg robot_1)"/>
    <param name="navigation_topic" value="$(arg navigation_topic_robot_1)"/>
    <param name="section_action" value="/$(arg robot_1)/pilot/world_section_req"/>
    <param name="section_result" value="/$(arg robot_1)/pilot/world_section_req/result"/>
    <remap from="/task_monitoring" to="$(arg robot_1)/task_monitoring"/>
  </node>

  <!-- Robot 2: turbot2 AUV -->
  <node name="multi_robot_system_$(arg robot_2)" pkg="multi_robot_system" type="multirobot_system.py" output="screen" respawn="true">
    <param name="robot_ID" value="1"/>
    <param name="robot_name" value="$(arg robot_2)"/>
    <param name="navigation_topic" value="$(arg navigation_topic_robot_2)"/>
    <param name="section_action" value="/$(arg robot_2)/pilot/world_section_req"/>
    <param name="section_result" value="/$(arg robot_2)/pilot/world_section_req/result"/>
    <remap from="/task_monitoring" to="$(arg robot_2)/task_monitoring"/>
  </node>

  <!-- Robot 3: xiroi ASV -->
  <node name="multi_robot_system_$(arg robot_3)" pkg="multi_robot_system" type="multirobot_system.py" output="screen" respawn="true">
    <param name="robot_ID" value="2"/>
    <param name="robot_name" value= "$(arg robot_3)"/>
    <param name="navigation_topic" value="$(arg navigation_topic_robot_3)"/>
    <param name="section_action" value="/$(arg robot_3)/pilot/world_section_req"/>
    <param name="section_result" value="/$(arg robot_3)/pilot/world_section_req/result"/>
    <remap from="/task_monitoring" to="$(arg robot_3)/task_monitoring"/>
  </node>

  <!-- Collision avoidance module -->
  <node if="$(arg enableCollisonAvoidance)" name="collision_avoidance" pkg="multi_robot_system" type="collision_avoidance.py" output="screen" respawn="true">
    <!-- <param name="r0_navigation_topic" value="$(arg navigation_topic_robot_1)"/>
    <param name="r1_navigation_topic" value="$(arg navigation_topic_robot_2)"/>
    <param name="r2_navigation_topic" value="$(arg navigation_topic_robot_3)"/> -->
    <param name="robot1_name" value="$(arg robot_1)"/>
    <param name="robot2_name" value="$(arg robot_2)"/>
    <param name="robot3_name" value="$(arg robot_3)"/>
    <param name="repulsion_radius" value="10"/>
    <param name="anchor_radius" value="20"/>

    <param name="robot_ID" value="1"/>
    <param name="robot_slave_name" value="xiroi"/>
    <param name="r1_bvr_topic" value="/xiroi/controller/body_velocity_req"/>
  </node>

  <!-- Communications module -->
  <node if="$(arg enableCommunicationModule)" name="communications" pkg="multi_robot_system" type="communications.py" output="screen" respawn="true">
    <param name="r0_navigation_topic" value="$(arg navigation_topic_robot_1)"/>
    <param name="r1_navigation_topic" value="$(arg navigation_topic_robot_2)"/>
    <param name="low_noise" value= "0.9"/>
    <param name="medium_noise" value="0.6"/>
    <param name="high_noise" value="0.3"/>
    <param name="low_distance" value= "10"/>
    <param name="medium_distance" value="40"/>
    <param name="large_distance" value="80"/>
  </node>

  <!-- RViz -->
  <node if="$(arg enableRviz)" pkg="rviz" type="rviz" name="rviz" args="-d $(find multi_robot_system)/scene/MRS.rviz"/>

</launch>

